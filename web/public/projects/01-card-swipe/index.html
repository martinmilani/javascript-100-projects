<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Card Swipe</title>
  </head>
  <body>
    <main>
      <section>
        <header>
          <img src="./tinder-logo.webp" alt="Tinder Logo" />
        </header>

        <div class="cards">
          <article>
            <img src="./photos/1.webp" alt="amumu" />
            <h2>Amumu</h2>
            <div class="choise nope">NOPE</div>
            <div class="choise like">LIKE</div>
          </article>
          <article>
            <img src="./photos/2.webp" alt="Zed" />
            <h2>Zed</h2>
            <div class="choise nope">NOPE</div>
            <div class="choise like">LIKE</div>
          </article>
          <article>
            <img src="./photos/3.webp" alt="Pantheon" />
            <h2>Pantheon</h2>
            <div class="choise nope">NOPE</div>
            <div class="choise like">LIKE</div>
          </article>
          <article>
            <img src="./photos/4.webp" alt="Pyke" />
            <h2>Pyke</h2>
            <div class="choise nope">NOPE</div>
            <div class="choise like">LIKE</div>
          </article>
          <article>
            <img src="./photos/5.webp" alt="Miss Fortune" />
            <h2>Miss Fortune</h2>
            <div class="choise nope">NOPE</div>
            <div class="choise like">LIKE</div>
          </article>
          <article>
            <img src="./photos/6.webp" alt="Morgana" />
            <h2>Morgana</h2>
            <div class="choise nope">NOPE</div>
            <div class="choise like">LIKE</div>
          </article>
          
          <article>
            <img src="./photos/7.webp" alt="Rengar" />
            <h2>Rengar</h2>
            <div class="choise nope">NOPE</div>
            <div class="choise like">LIKE</div>
          </article>
          <article>
            <img src="./photos/8.webp" alt="Katarina" />
            <h2>Katarina</h2>
            <div class="choise nope">NOPE</div>
            <div class="choise like">LIKE</div>
          </article>
          <span>
            No more cards to show 
          <br />
            Try again later.
          </span>
        </div>

        <footer>
          <button class="is-undo" aria-label="undo"></button>
          <button class="is-remove is-big" aria-label="remove"></button>
          <button class="is-star"aria-label="star"></button>
          <button class="is-fav is-big" aria-label="fav"></button>
          <button class="is-zap" aria-label="zap"></button>
        </footer>
      </section>
    </main>
    <style>
      *,
      *::before,
      *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",
          sans-serif;
        display: grid;
        place-content: center;
        min-height: 100vh;
        overflow: hidden;
        user-select: none;
        background: #e5e5e5;
      }
      main {
        background: url("./iphone.webp") no-repeat;
        background-size: contain;
        width: 320px;
        height: 640px;
        display: flex;
        filter: drop-shadow(0 0 10px rgba(0, 0, 0, 0.3));
      }
      section {
        background: #f7f7f7;
        width: 100%;
        border-radius: 32px;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        position: relative;
        padding: 16px 6px;
        margin: 24px;
        gap: 24px
      }
      header {
        display: flex;
        justify-content: center;

        & img {
          width: 24px;
          height: 24px;
        }
      }
      footer {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 12px;
        padding: 0 24px;
        justify-content: center;
        align-items: center;

        & button {
          background: url('./tinder-icons.webp') no-repeat;
          background-position: 0px 0px;
          background-size: 175px;
          height: 32px;
          width: 32px;
          border-radius: 50%;
          border: 0;
          cursor: pointer;
          transition: scale .3s ease;

          &:hover {
            scale: 1.4;
          }

          &.is-big {
            background-size: 270px;
            width: 48px;
            height: 48px;
          }

          &.is-undo {
            background-position: -142px 0;
          }

          &.is-remove {
            background-position: -164px 0;
          }

          &.is-star {
            background-position: -70px 0;
          }

          &.is-fav {
            background-position: -55px 0;
          }
        }
      }

      .cards {
        position: relative;
        width: 100%;
        height: 100%;
        margin: 0 auto;

        &  > span {
          display: grid;
          place-content: center;
          color: #52525277;
          font-size: 14px;
          text-align: center;
          height: 100%;
          z-index: -1;
        }

        & article {
          cursor: grab;
          box-shadow: 0 0 10px rgba(0,0,0,.3);
          border-radius: 16px;
          overflow: hidden;
          position: absolute;
          width: 100%;
          height: 100%;
          inset: 0;
          z-index: 2;

          &.go-left {
            transform: translate(-150%) rotate(-30deg) !important;
          }

          &.go-right {
            transform: translate(150%) rotate(30deg) !important;
          }

          &.go-left,
          &.go-right {
            transition: transform .3s ease, rotate .3s ease;
          }

          &.reset {
            transition: transform .3s ease;
            transform: translateX(0) !important;
          }

          & .choise {
            border-radius: 8px;
            color: black;
            border: 4px solid;
            z-index: 99999;
            position: absolute;
            top: 32px;
            right: 16px;
            padding: 4px 8px;
            font-size:24px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0,0,0,.3);
            width: fit-content;
            opacity: 0;

            &.nope {
              border-color: #FF6E63;
              color: #FF6E63;
              transform: rotate(30deg)
            }
            
            &.like {
              border-color: #63FF68;
              color: #63FF68;
              left:16px;
              transform: rotate(-30deg)
            }
          }

          & img {
            width: 100%;
            height: 100%;
            object-fit: cover;
          }

          & h2 {
            color: white;
            position: absolute; 
            inset: 0;
            display: flex;
            align-items: flex-end;
            height: 100%;
            width: 100%;
            padding: 16px;
            z-index: 3;
            background: linear-gradient(to top, #00000088 20%, transparent 40%);
          }
        }
      }
    </style>
    <script>
      const DECISION_THRESHOLD = 150;
      let isAnimating = false;
      let pullDeltaX = 0; // Disstancia que la car se esta arrastrando

      function startDrag(event) {
    
        if(isAnimating) return 

        // Get first article element
        const actualCard = event.target.closest('article');
        if(!actualCard) return

        // Get initial position 
        const startX = event.pageX ?? event.touches[0].pageX;

        // Listen for mouse move and touch move
        document.addEventListener('mousemove', onMove)
        document.addEventListener('mouseup', onEnd)
       
        document.addEventListener('touchmove', onMove, {passive: true})
        document.addEventListener('touchend', onEnd, {passive: true})

        function onMove (event) {
          // Get current position of mouse or finger
          const currentX = event.pageX ?? event.touches[0].pageX;
          // The distance between initial position and current position
          pullDeltaX = currentX - startX;
          // No distance moved
          if(pullDeltaX === 0) return 
          // Change the flag true indicate that is animating
          isAnimating= true
          // Calculate the rotation of the card using the distance moved
          const deg = pullDeltaX / 14
          // Apply the rotation to the card
          actualCard.style.transform = `translateX(${pullDeltaX}px) rotate(${deg}deg)`
          // Change cursor to grabbing
          actualCard.style.cursor = 'grabbing'
          // Change choice tag to show the user the decision
          const opacity = Math.abs(pullDeltaX) / 100
          isRight = pullDeltaX > 0
          
          const choiceEl = isRight ? actualCard.querySelector('.like') : actualCard.querySelector('.nope')
          choiceEl.style.opacity = opacity

        }
  
        function onEnd (event) {
          // Remove event listeners
          document.removeEventListener('mousemove', onMove)
          document.removeEventListener('mouseup', onEnd)

          document.removeEventListener('touchmove', onMove)
          document.removeEventListener('touchend', onEnd)


          // Know if the user has taked a decision
          const decisionMade = Math.abs(pullDeltaX) >= DECISION_THRESHOLD
      
          if(decisionMade) {
            const goRight = pullDeltaX >= 0;
            const goLeft = pullDeltaX < 0;
            actualCard.classList.add(goRight ? 'go-right' : 'go-left')
            actualCard.addEventListener('transitionend', () => {
              actualCard.remove()
            })
          }else{
            actualCard.classList.add('reset')
            actualCard.classList.remove('go-right', 'go-left')
            actualCard.querySelectorAll('.choise').forEach(el => el.style.opacity = 0)
          }

          // Reset variables
          actualCard.addEventListener('transitionend', () => {
            actualCard.removeAttribute('style')
            actualCard.classList.remove('reset')

            pullDeltaX = 0;
            isAnimating = false
          })
        }
      }

      document.addEventListener('mousedown', startDrag)
      document.addEventListener('touchstart', startDrag, {passive: true})
    </script>
  </body>
</html>
